# Workflow Diagrams

**Audience**: Developers, Architects

Visual workflows for rustful-ts operations.

## 1. Data Flow

How data moves through the system from input to output.

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                              DATA FLOW                                           │
└─────────────────────────────────────────────────────────────────────────────────┘

                    ┌─────────────────┐
                    │   Input Data    │
                    │                 │
                    │ • Array/Vec     │
                    │ • CSV file      │
                    │ • JSON          │
                    │ • Yahoo Finance │
                    └────────┬────────┘
                             │
                             ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           INTERFACE LAYER                                        │
│                                                                                  │
│   TypeScript                    REST API                     CLI                 │
│   ──────────                    ────────                     ───                 │
│   number[] ──────┐         JSON Body ──────┐         CSV File ──────┐           │
│                  │                         │                        │           │
│                  ▼                         ▼                        ▼           │
│           Float64Array              Deserialize              Parse CSV          │
│                  │                         │                        │           │
└──────────────────┼─────────────────────────┼────────────────────────┼───────────┘
                   │                         │                        │
                   └─────────────────────────┼────────────────────────┘
                                             │
                                             ▼
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           PROCESSING                                             │
│                                                                                  │
│                        ┌─────────────────┐                                       │
│                        │   Validation    │                                       │
│                        │                 │                                       │
│                        │ • Length check  │                                       │
│                        │ • NaN handling  │                                       │
│                        │ • Type check    │                                       │
│                        └────────┬────────┘                                       │
│                                 │                                                │
│                                 ▼                                                │
│                        ┌─────────────────┐                                       │
│                        │  Preprocessing  │                                       │
│                        │                 │                                       │
│                        │ • Normalize     │                                       │
│                        │ • Difference    │                                       │
│                        │ • Decompose     │                                       │
│                        └────────┬────────┘                                       │
│                                 │                                                │
│                                 ▼                                                │
│                        ┌─────────────────┐                                       │
│                        │   Algorithm     │                                       │
│                        │                 │                                       │
│                        │ • fit()         │                                       │
│                        │ • predict()     │                                       │
│                        │ • detect()      │                                       │
│                        └────────┬────────┘                                       │
│                                 │                                                │
│                                 ▼                                                │
│                        ┌─────────────────┐                                       │
│                        │ Postprocessing  │                                       │
│                        │                 │                                       │
│                        │ • Inverse       │                                       │
│                        │   transform     │                                       │
│                        │ • Metrics       │                                       │
│                        └────────┬────────┘                                       │
│                                 │                                                │
└─────────────────────────────────┼───────────────────────────────────────────────┘
                                  │
                                  ▼
                    ┌─────────────────┐
                    │     Output      │
                    │                 │
                    │ • Forecast[]    │
                    │ • Anomalies[]   │
                    │ • Metrics       │
                    │ • Alerts        │
                    └─────────────────┘
```

## 2. Forecast Workflow

The fit → predict pipeline for time series forecasting.

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                           FORECAST WORKFLOW                                      │
└─────────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────┐
     │ Historical   │
     │ Data         │
     │ [1,2,3,4,5]  │
     └──────┬───────┘
            │
            ▼
┌───────────────────────────────────────┐
│           PIPELINE (Optional)          │
│                                        │
│  ┌─────────┐  ┌─────────┐  ┌────────┐ │
│  │Normalize│─▶│Difference│─▶│  Log   │ │
│  └─────────┘  └─────────┘  └────────┘ │
│                                        │
└───────────────────┬────────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐
│              MODEL SELECTION           │
│                                        │
│  ┌─────────────────────────────────┐  │
│  │         AutoSelector            │  │
│  │                                 │  │
│  │  ┌───────┐ ┌───────┐ ┌───────┐ │  │
│  │  │ ARIMA │ │  SES  │ │ Holt  │ │  │
│  │  └───┬───┘ └───┬───┘ └───┬───┘ │  │
│  │      │         │         │      │  │
│  │      └────┬────┴────┬────┘      │  │
│  │           │         │           │  │
│  │           ▼         ▼           │  │
│  │      Cross-Validate & Score     │  │
│  │           │                     │  │
│  │           ▼                     │  │
│  │      Select Best Model          │  │
│  └─────────────────────────────────┘  │
│                                        │
└───────────────────┬────────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐
│               FIT                      │
│                                        │
│  model.fit(data)                       │
│                                        │
│  ┌─────────────────────────────────┐  │
│  │  • Estimate parameters          │  │
│  │  • Store internal state         │  │
│  │  • Mark as fitted               │  │
│  └─────────────────────────────────┘  │
│                                        │
└───────────────────┬────────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐
│             PREDICT                    │
│                                        │
│  model.predict(steps=5)                │
│                                        │
│  ┌─────────────────────────────────┐  │
│  │  • Generate future values       │  │
│  │  • Apply inverse transforms     │  │
│  │  • Return forecast array        │  │
│  └─────────────────────────────────┘  │
│                                        │
└───────────────────┬────────────────────┘
                    │
                    ▼
     ┌──────────────────────┐
     │      Forecast        │
     │   [6.1, 7.0, 7.9,    │
     │    8.8, 9.7]         │
     └──────────────────────┘
```

## 3. Anomaly Detection Workflow

Real-time anomaly detection and alerting.

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                       ANOMALY DETECTION WORKFLOW                                 │
└─────────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────┐
     │ Historical   │
     │ Baseline     │
     │ Data         │
     └──────┬───────┘
            │
            ▼
┌───────────────────────────────────────┐
│         DETECTOR TRAINING              │
│                                        │
│  detector = ZScoreDetector(threshold=3)│
│  detector.fit(historical_data)         │
│                                        │
│  ┌─────────────────────────────────┐  │
│  │  • Calculate mean: μ            │  │
│  │  • Calculate std_dev: σ         │  │
│  │  • Store threshold: 3σ          │  │
│  └─────────────────────────────────┘  │
│                                        │
└───────────────────┬────────────────────┘
                    │
                    ▼
┌───────────────────────────────────────┐
│            MONITOR SETUP               │
│                                        │
│  monitor = Monitor(detector,           │
│                    window_size=100)    │
│                                        │
│  ┌─────────────────────────────────┐  │
│  │  • Initialize ring buffer       │  │
│  │  • Set alert callbacks          │  │
│  │  • Configure severity levels    │  │
│  └─────────────────────────────────┘  │
│                                        │
└───────────────────┬────────────────────┘
                    │
                    ▼
┌───────────────────────────────────────────────────────────────────────────────┐
│                         REAL-TIME LOOP                                         │
│                                                                                │
│   ┌────────────┐                                                               │
│   │ New Value  │◀─────────────────────────────────────────────────────┐       │
│   │ arrives    │                                                       │       │
│   └─────┬──────┘                                                       │       │
│         │                                                              │       │
│         ▼                                                              │       │
│   ┌─────────────────┐                                                  │       │
│   │ monitor.update  │                                                  │       │
│   │ (value)         │                                                  │       │
│   └─────┬───────────┘                                                  │       │
│         │                                                              │       │
│         ▼                                                              │       │
│   ┌─────────────────┐      ┌─────────────────┐                        │       │
│   │ Calculate Score │      │                 │                        │       │
│   │                 │      │  score < 3σ     │───── Normal ───────────┘       │
│   │ score = |x-μ|/σ │─────▶│  ?              │                                │
│   │                 │      │                 │                                │
│   └─────────────────┘      └────────┬────────┘                                │
│                                     │                                          │
│                               score >= 3σ                                      │
│                                     │                                          │
│                                     ▼                                          │
│                            ┌─────────────────┐                                 │
│                            │ Classify        │                                 │
│                            │ Severity        │                                 │
│                            └────────┬────────┘                                 │
│                                     │                                          │
│         ┌───────────────────────────┼───────────────────────────┐              │
│         │                           │                           │              │
│         ▼                           ▼                           ▼              │
│   ┌───────────┐             ┌───────────┐             ┌───────────┐           │
│   │   LOW     │             │  MEDIUM   │             │   HIGH    │           │
│   │  3σ - 4σ  │             │  4σ - 5σ  │             │   > 5σ    │           │
│   └─────┬─────┘             └─────┬─────┘             └─────┬─────┘           │
│         │                         │                         │                  │
│         └─────────────────────────┼─────────────────────────┘                  │
│                                   │                                            │
│                                   ▼                                            │
│                          ┌─────────────────┐                                   │
│                          │  Create Alert   │                                   │
│                          │                 │                                   │
│                          │ • timestamp     │                                   │
│                          │ • value         │                                   │
│                          │ • score         │                                   │
│                          │ • severity      │                                   │
│                          └────────┬────────┘                                   │
│                                   │                                            │
│                                   ▼                                            │
│                          ┌─────────────────┐                                   │
│                          │ Trigger         │                                   │
│                          │ Callback        │                                   │
│                          │                 │                                   │
│                          │ onAnomaly(alert)│                                   │
│                          └─────────────────┘                                   │
│                                                                                │
└────────────────────────────────────────────────────────────────────────────────┘
```

## 4. Backtest Workflow

Trading strategy backtesting flow.

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                          BACKTEST WORKFLOW                                       │
└─────────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────┐     ┌──────────────┐
     │ Historical   │     │   Strategy   │
     │ Prices       │     │              │
     │ OHLCV        │     │ SMACrossover │
     └──────┬───────┘     │ (20, 50)     │
            │             └──────┬───────┘
            │                    │
            └─────────┬──────────┘
                      │
                      ▼
┌───────────────────────────────────────┐
│          BACKTESTER SETUP              │
│                                        │
│  config = BacktestConfig {             │
│    initial_capital: 100_000,           │
│    commission: 0.001,                  │
│    slippage: 0.0005                    │
│  }                                     │
│                                        │
└───────────────────┬────────────────────┘
                    │
                    ▼
┌────────────────────────────────────────────────────────────────────────────────┐
│                           SIMULATION LOOP                                       │
│                                                                                 │
│  for each bar in historical_data:                                               │
│                                                                                 │
│   ┌─────────────────┐                                                           │
│   │  Calculate      │                                                           │
│   │  Indicators     │                                                           │
│   │                 │                                                           │
│   │  SMA_20 = ...   │                                                           │
│   │  SMA_50 = ...   │                                                           │
│   └────────┬────────┘                                                           │
│            │                                                                    │
│            ▼                                                                    │
│   ┌─────────────────┐                                                           │
│   │  Generate       │                                                           │
│   │  Signal         │                                                           │
│   └────────┬────────┘                                                           │
│            │                                                                    │
│            ├─────────────────────┬─────────────────────┐                        │
│            │                     │                     │                        │
│            ▼                     ▼                     ▼                        │
│   ┌─────────────────┐   ┌─────────────────┐   ┌─────────────────┐              │
│   │      BUY        │   │      SELL       │   │      HOLD       │              │
│   │                 │   │                 │   │                 │              │
│   │ SMA_20 crosses  │   │ SMA_20 crosses  │   │ No crossover    │              │
│   │ above SMA_50    │   │ below SMA_50    │   │                 │              │
│   └────────┬────────┘   └────────┬────────┘   └────────┬────────┘              │
│            │                     │                     │                        │
│            ▼                     ▼                     │                        │
│   ┌─────────────────┐   ┌─────────────────┐            │                        │
│   │ Execute Trade   │   │ Execute Trade   │            │                        │
│   │                 │   │                 │            │                        │
│   │ • Open position │   │ • Close position│            │                        │
│   │ • Apply commiss │   │ • Apply commiss │            │                        │
│   │ • Apply slippage│   │ • Apply slippage│            │                        │
│   │ • Record trade  │   │ • Record P&L    │            │                        │
│   └────────┬────────┘   └────────┬────────┘            │                        │
│            │                     │                     │                        │
│            └─────────────────────┴─────────────────────┘                        │
│                                  │                                              │
│                                  ▼                                              │
│                         ┌─────────────────┐                                     │
│                         │ Update          │                                     │
│                         │ Portfolio       │                                     │
│                         │                 │                                     │
│                         │ • Cash balance  │                                     │
│                         │ • Positions     │                                     │
│                         │ • Equity curve  │                                     │
│                         └────────┬────────┘                                     │
│                                  │                                              │
│                                  ▼                                              │
│                         ┌─────────────────┐                                     │
│                         │ Next Bar        │────────────▶ (loop)                 │
│                         └─────────────────┘                                     │
│                                                                                 │
└─────────────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌───────────────────────────────────────┐
│          CALCULATE METRICS             │
│                                        │
│  ┌─────────────────────────────────┐  │
│  │ Performance                     │  │
│  │ ────────────                    │  │
│  │ • Total Return: 23.5%           │  │
│  │ • CAGR: 18.2%                   │  │
│  │ • Win Rate: 58%                 │  │
│  └─────────────────────────────────┘  │
│                                        │
│  ┌─────────────────────────────────┐  │
│  │ Risk                            │  │
│  │ ────                            │  │
│  │ • Sharpe Ratio: 1.45            │  │
│  │ • Sortino Ratio: 1.89           │  │
│  │ • Max Drawdown: -12.3%          │  │
│  │ • VaR (95%): -2.1%              │  │
│  └─────────────────────────────────┘  │
│                                        │
│  ┌─────────────────────────────────┐  │
│  │ Trading                         │  │
│  │ ───────                         │  │
│  │ • Total Trades: 47              │  │
│  │ • Avg Trade: +0.5%              │  │
│  │ • Profit Factor: 1.8            │  │
│  └─────────────────────────────────┘  │
│                                        │
└───────────────────────────────────────┘
                    │
                    ▼
     ┌──────────────────────┐
     │   BacktestResult     │
     │                      │
     │ • equity_curve       │
     │ • trades             │
     │ • metrics            │
     └──────────────────────┘
```

## Summary

| Workflow | Purpose | Key Components |
|----------|---------|----------------|
| Data Flow | How data moves through system | Validation → Processing → Output |
| Forecast | Generate predictions | Pipeline → Model → Predict |
| Anomaly | Detect outliers | Detector → Monitor → Alert |
| Backtest | Test trading strategies | Strategy → Simulate → Metrics |

---

**Related Documentation**:
- [Architecture](architecture.md) - System architecture
- [Block Diagram](block-diagram.md) - Component overview

**Last Updated**: 2025-12-28
